<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Price Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Bebas+Neue&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --bg: #0e0e0f;
            --surface: #16171a;
            --surface2: #1e2024;
            --border: #2a2d35;
            --accent: #e8ff47;
            --accent2: #47d9ff;
            --text: #f0f0f0;
            --muted: #6b7280;
            --danger: #ff5c5c;
            --success: #4ade80;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'DM Sans', sans-serif;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 18px 40px;
            display: flex;
            align-items: center;
            gap: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 28px;
            letter-spacing: 2px;
            color: var(--accent);
            line-height: 1;
        }

        .header-sub {
            font-size: 12px;
            color: var(--muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .step-trail {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .step-dot {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            border: 1.5px solid var(--border);
            color: var(--muted);
            transition: all .2s;
        }

        .step-dot.active {
            border-color: var(--accent);
            color: var(--accent);
        }

        .step-dot.done {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .step-dash {
            width: 20px;
            height: 1px;
            background: var(--border);
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 40px 80px;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 28px 32px;
            margin-bottom: 20px;
            transition: border-color .2s;
        }

        .card.active {
            border-color: var(--accent);
        }

        .card-title {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .card-title span {
            display: inline-block;
            background: var(--accent);
            color: var(--bg);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 10px;
            margin-right: 10px;
        }

        /* Segmented control */
        .seg-ctrl {
            display: flex;
            background: var(--surface2);
            border-radius: 8px;
            padding: 4px;
            gap: 4px;
            width: fit-content;
        }

        .seg-btn {
            padding: 8px 20px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: var(--muted);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all .15s;
        }

        .seg-btn.active {
            background: var(--accent);
            color: var(--bg);
        }

        /* Select */
        .custom-select {
            background: var(--surface2);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 8px;
            padding: 10px 14px;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            outline: none;
            cursor: pointer;
            min-width: 240px;
            transition: border-color .2s;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 36px;
        }

        .custom-select:focus {
            border-color: var(--accent);
        }

        /* Size/Qty Table */
        .sizes-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
        }

        .size-cell {
            text-align: center;
        }

        .size-label {
            font-size: 11px;
            color: var(--muted);
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .qty-input {
            width: 100%;
            background: var(--surface2);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            padding: 8px 4px;
            text-align: center;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            outline: none;
            transition: border-color .2s;
            -moz-appearance: textfield;
        }

        .qty-input::-webkit-outer-spin-button,
        .qty-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        .qty-input:focus {
            border-color: var(--accent);
        }

        .total-qty {
            margin-top: 16px;
            font-size: 13px;
            color: var(--muted);
        }

        .total-qty strong {
            color: var(--accent);
            font-size: 18px;
        }

        /* Addons */
        .addons-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .addon-location {
            background: var(--surface2);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .addon-loc-header {
            padding: 10px 16px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent2);
            background: rgba(71, 217, 255, .06);
            border-bottom: 1px solid var(--border);
        }

        .addon-rows {
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .addon-row {
            display: grid;
            grid-template-columns: 180px 1fr 100px 100px 80px 100px 100px;
            gap: 10px;
            align-items: center;
        }

        .addon-type {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .addon-col-label {
            font-size: 10px;
            color: var(--muted);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 3px;
        }

        .field-group {
            display: flex;
            flex-direction: column;
        }

        .info-val {
            font-size: 13px;
            color: var(--text);
            padding: 8px 0;
        }

        /* Toggle */
        .toggle-wrap {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .toggle {
            width: 38px;
            height: 22px;
            background: var(--border);
            border-radius: 11px;
            position: relative;
            transition: background .2s;
        }

        .toggle.on {
            background: var(--accent);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            top: 3px;
            left: 3px;
            transition: transform .2s;
        }

        .toggle.on::after {
            transform: translateX(16px);
        }

        /* Colors input */
        .num-input {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            padding: 7px 10px;
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            outline: none;
            width: 100%;
            -moz-appearance: textfield;
            transition: border-color .2s;
        }

        .num-input::-webkit-outer-spin-button,
        .num-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        .num-input:focus {
            border-color: var(--accent);
        }

        /* Addon type badges */
        .location-badge {
            font-size: 9px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 3px;
            letter-spacing: 1px;
            text-transform: uppercase;
            background: rgba(232, 255, 71, .1);
            color: var(--accent);
            border: 1px solid rgba(232, 255, 71, .2);
        }

        /* Summary */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .summary-item {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 18px 20px;
        }

        .summary-label {
            font-size: 11px;
            color: var(--muted);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .summary-val {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 32px;
            color: var(--text);
            letter-spacing: 1px;
        }

        .summary-val.accent {
            color: var(--accent);
        }

        .summary-val small {
            font-size: 16px;
            color: var(--muted);
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .breakdown-table th {
            text-align: left;
            padding: 8px 12px;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--muted);
            background: var(--surface2);
            border-bottom: 1px solid var(--border);
        }

        .breakdown-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .breakdown-table tr:last-child td {
            border-bottom: none;
        }

        .breakdown-table .total-row td {
            font-weight: 600;
            color: var(--accent);
            background: rgba(232, 255, 71, .04);
            border-top: 1px solid var(--border);
        }

        /* Shipping */
        .shipping-wrap {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--surface2);
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .shipping-wrap label {
            font-size: 13px;
            color: var(--muted);
            min-width: 180px;
        }

        .shipping-input {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 8px;
            padding: 9px 14px;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            outline: none;
            width: 160px;
            -moz-appearance: textfield;
            transition: border-color .2s;
        }

        .shipping-input::-webkit-outer-spin-button,
        .shipping-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        .shipping-input:focus {
            border-color: var(--accent);
        }

        /* Warning */
        .warning {
            background: rgba(255, 92, 92, .08);
            border: 1px solid rgba(255, 92, 92, .3);
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 12px;
            color: #ff8a8a;
            margin-top: 10px;
        }

        /* Responsive fixes */
        @media (max-width: 900px) {
            .addon-row {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .sizes-grid {
                grid-template-columns: repeat(5, 1fr);
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 24px 16px 60px;
            }

            .header {
                padding: 16px 20px;
            }
        }
    </style>
</head>

<body>
    <div id="app">

        <!-- Header -->
        <div class="header">
            <div>
                <div class="header-logo">PriceCalc</div>
                <div class="header-sub">Product Price Calculator</div>
            </div>
            <div class="step-trail">
                <div class="step-dot" :class="{active: step===1, done: step>1}">1</div>
                <div class="step-dash"></div>
                <div class="step-dot" :class="{active: step===2, done: step>2}">2</div>
                <div class="step-dash"></div>
                <div class="step-dot" :class="{active: step===3, done: step>3}">3</div>
                <div class="step-dash"></div>
                <div class="step-dot" :class="{active: step===4}">4</div>
            </div>
        </div>

        <div class="container">

            <!-- Step 1: Customer Type -->
            <div class="card" :class="{active: step===1}">
                <div class="card-title"><span>1</span>Customer Type</div>
                <div class="seg-ctrl">
                    <button v-for="ct in customerTypes" :key="ct" class="seg-btn" :class="{active: customerType===ct}"
                        @click="setCustomerType(ct)">{{ct}}</button>
                </div>
            </div>

            <!-- Step 2: Style -->
            <div class="card" :class="{active: step===2}">
                <div class="card-title"><span>2</span>Product Style</div>
                <select class="custom-select" v-model="selectedProduct" @change="onProductChange">
                    <option value="">— Select Product —</option>
                    <option v-for="p in products" :key="p" :value="p">{{p}}</option>
                </select>
            </div>

            <!-- Step 3: Size & Qty -->
            <div class="card" :class="{active: step===3}" v-if="selectedProduct">
                <div class="card-title"><span>3</span>Size &amp; Quantity</div>

                <div style="margin-bottom:12px;">
                    <div style="font-size:12px;color:var(--muted);margin-bottom:10px;">XS — L</div>
                    <div class="sizes-grid" style="grid-template-columns: repeat(5,1fr);">
                        <div class="size-cell" v-for="s in sizes.slice(0,5)" :key="s">
                            <div class="size-label">{{s}}</div>
                            <input type="number" class="qty-input" min="0" v-model.number="quantities[s]"
                                @input="onQtyChange" />
                        </div>
                    </div>
                </div>
                <div>
                    <div style="font-size:12px;color:var(--muted);margin-bottom:10px;">XL — 4XL</div>
                    <div class="sizes-grid" style="grid-template-columns: repeat(5,1fr);">
                        <div class="size-cell" v-for="s in sizes.slice(5)" :key="s">
                            <div class="size-label">{{s}}</div>
                            <input type="number" class="qty-input" min="0" v-model.number="quantities[s]"
                                @input="onQtyChange" />
                        </div>
                    </div>
                </div>

                <div class="total-qty" style="margin-top:18px;">Total Qty: <strong>{{totalQty}}</strong></div>

                <div class="warning" v-if="pricePerItem === 0 && totalQty > 0">
                    No pricing found for this product + quantity combination.
                </div>
            </div>

            <!-- Step 4: Add-ons -->
            <div class="card" :class="{active: step===4}" v-if="totalQty > 0">
                <div class="card-title"><span>4</span>Add-ons / Decoration</div>

                <div class="addons-section">
                    <div class="addon-location" v-for="loc in addonLocations" :key="loc.name">
                        <div class="addon-loc-header">
                            {{loc.name}}
                        </div>
                        <div class="addon-rows">
                            <div v-for="addon in loc.addons" :key="addon.type" class="addon-row">
                                <!-- Toggle + Name -->
                                <div class="addon-type">
                                    <div class="toggle-wrap" @click="toggleAddon(loc.name, addon.type)">
                                        <div class="toggle" :class="{on: isAddonEnabled(loc.name, addon.type)}"></div>
                                    </div>
                                    <span>{{addon.type}}</span>
                                </div>

                                <!-- Setup Charge -->
                                <div class="field-group">
                                    <div class="addon-col-label">Setup Charge</div>
                                    <div class="info-val">₹{{getSetupCharge(addon.type)}}</div>
                                </div>

                                <!-- Rate -->
                                <div class="field-group" v-if="['DTG','DTF','Screen Print'].includes(addon.type)">
                                    <div class="addon-col-label">Rate/cm²</div>
                                    <div class="info-val">₹{{getRate(addon.type)}}</div>
                                </div>
                                <div class="field-group" v-else-if="addon.type.startsWith('Embroidery')">
                                    <div class="addon-col-label">Rate/1k stitch</div>
                                    <div class="info-val">₹{{getRate(addon.type)}}</div>
                                </div>
                                <div class="field-group" v-else>
                                    <div class="addon-col-label">Rate/pc</div>
                                    <div class="info-val">₹{{getRate(addon.type)}}</div>
                                </div>

                                <!-- Colours (Screen Print only) -->
                                <div class="field-group" v-if="addon.type === 'Screen Print'">
                                    <div class="addon-col-label">Colours</div>
                                    <input type="number" class="num-input" min="1"
                                        :disabled="!isAddonEnabled(loc.name, addon.type)"
                                        v-model.number="getAddonState(loc.name, addon.type).colours" @input="recalc" />
                                </div>
                                <div v-else></div>

                                <!-- Width -->
                                <div class="field-group" v-if="['DTG','DTF','Screen Print'].includes(addon.type)">
                                    <div class="addon-col-label">W (cm)</div>
                                    <input type="number" class="num-input" min="1"
                                        :disabled="!isAddonEnabled(loc.name, addon.type)"
                                        v-model.number="getAddonState(loc.name, addon.type).width" @input="recalc" />
                                </div>
                                <div class="field-group" v-else-if="addon.type.startsWith('Embroidery')">
                                    <div class="addon-col-label">W (cm)</div>
                                    <input type="number" class="num-input" min="1"
                                        :disabled="!isAddonEnabled(loc.name, addon.type)"
                                        v-model.number="getAddonState(loc.name, addon.type).width" @input="recalc" />
                                </div>
                                <div v-else></div>

                                <!-- Height -->
                                <div class="field-group" v-if="['DTG','DTF','Screen Print'].includes(addon.type)">
                                    <div class="addon-col-label">H (cm)</div>
                                    <input type="number" class="num-input" min="1"
                                        :disabled="!isAddonEnabled(loc.name, addon.type)"
                                        v-model.number="getAddonState(loc.name, addon.type).height" @input="recalc" />
                                </div>
                                <div class="field-group" v-else-if="addon.type.startsWith('Embroidery')">
                                    <div class="addon-col-label">H (cm)</div>
                                    <input type="number" class="num-input" min="1"
                                        :disabled="!isAddonEnabled(loc.name, addon.type)"
                                        v-model.number="getAddonState(loc.name, addon.type).height" @input="recalc" />
                                </div>
                                <div v-else></div>

                                <!-- Total per item -->
                                <div class="field-group">
                                    <div class="addon-col-label">Total/item</div>
                                    <div class="info-val" style="color:var(--accent2)">₹{{fmt(getAddonTotal(loc.name,
                                        addon.type))}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="card" v-if="totalQty > 0" style="border-color:var(--accent)">
                <div class="card-title" style="color:var(--accent)">Price Summary</div>

                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Base Price/Item</div>
                        <div class="summary-val">₹<small></small>{{fmt(pricePerItem)}}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Qty</div>
                        <div class="summary-val accent">{{totalQty}}<small> pcs</small></div>
                    </div>
                </div>

                <div class="shipping-wrap" style="margin-bottom:20px;">
                    <label>Shipping &amp; Other Charges (₹)</label>
                    <input type="number" class="shipping-input" v-model.number="shippingCharges" min="0"
                        @input="recalc" />
                </div>

                <table class="breakdown-table">
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th style="text-align:right">Per Item (₹)</th>
                            <th style="text-align:right">Total (₹)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Base Product Price</td>
                            <td style="text-align:right">{{fmt(pricePerItem)}}</td>
                            <td style="text-align:right">{{fmt(pricePerItem * totalQty)}}</td>
                        </tr>
                        <tr v-for="row in addonBreakdown" :key="row.label">
                            <td>{{row.label}}</td>
                            <td style="text-align:right">{{fmt(row.perItem)}}</td>
                            <td style="text-align:right">{{fmt(row.total)}}</td>
                        </tr>
                        <tr>
                            <td>Setup Charges (total)</td>
                            <td style="text-align:right">—</td>
                            <td style="text-align:right">{{fmt(totalSetupCharges)}}</td>
                        </tr>
                        <tr>
                            <td>Shipping &amp; Other</td>
                            <td style="text-align:right">—</td>
                            <td style="text-align:right">{{fmt(shippingCharges)}}</td>
                        </tr>
                        <tr class="total-row">
                            <td>Grand Total</td>
                            <td style="text-align:right">{{fmt(finalPricePerItem)}}</td>
                            <td style="text-align:right">{{fmt(grandTotal)}}</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top:20px;display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                    <div class="summary-item" style="border-color:var(--accent)">
                        <div class="summary-label">Final Price Per Item</div>
                        <div class="summary-val accent">₹{{fmt(finalPricePerItem)}}</div>
                    </div>
                    <div class="summary-item" style="border-color:var(--accent)">
                        <div class="summary-label">Grand Total</div>
                        <div class="summary-val accent">₹{{fmt(grandTotal)}}</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const { createApp, reactive, ref, computed } = Vue;

        // ===== DATA =====

        const PRODUCT_DATA = [
            // [product, min, max, retail, corporate, reseller]
            ['Men Plain Crew Neck', 1, 10, 449, 349, 249],
            ['Men Plain Crew Neck', 11, 100, 429, 329, 249],
            ['Men Plain Crew Neck', 101, 500, 399, 299, 249],
            ['Men Plain Crew Neck', 501, null, 369, 269, 249],
            ['Men Amid Crew Neck', 1, 10, 499, 399, 299],
            ['Men Amid Crew Neck', 11, 100, 479, 379, 299],
            ['Men Amid Crew Neck', 101, 500, 449, 349, 299],
            ['Men Amid Crew Neck', 501, null, 419, 319, 299],
            ['Men SoftTouch Crew Neck', 1, 10, 599, 499, 399],
            ['Men SoftTouch Crew Neck', 11, 100, 579, 479, 399],
            ['Men SoftTouch Crew Neck', 101, 500, 549, 449, 399],
            ['Men SoftTouch Crew Neck', 501, null, 519, 419, 399],
            ['Men SoftTouch Oversized', 1, 10, 699, 599, 499],
            ['Men SoftTouch Oversized', 11, 100, 679, 579, 499],
            ['Men SoftTouch Oversized', 101, 500, 649, 549, 499],
            ['Men SoftTouch Oversized', 501, null, 619, 519, 499],
            ['Men Brisk Polo', 1, 9, 549, 449, 349],
            ['Men Brisk Polo', 11, 49, 529, 429, 349],
            ['Men Brisk Polo', 50, 99, 499, 399, 349],
            ['Men Brisk Polo', 100, null, 469, 369, 349],
            ['Men Plain Polo', 1, 9, 599, 499, 399],
            ['Men Plain Polo', 11, 49, 579, 479, 399],
            ['Men Plain Polo', 50, 99, 549, 449, 399],
            ['Men Plain Polo', 100, null, 519, 419, 399],
            ['Men Performance Polo', 1, 9, 649, 549, 449],
            ['Men Performance Polo', 11, 49, 629, 529, 449],
            ['Men Performance Polo', 50, 99, 599, 499, 449],
            ['Men Performance Polo', 100, null, 569, 469, 449],
            ['Men Flexi Polo', 1, 9, 699, 599, 499],
            ['Men Flexi Polo', 11, 49, 679, 579, 499],
            ['Men Flexi Polo', 50, 99, 649, 549, 499],
            ['Men Flexi Polo', 100, null, 619, 519, 499],
            ['Men SoftTouch Polo', 1, 9, 749, 649, 549],
            ['Men SoftTouch Polo', 11, 49, 729, 629, 549],
            ['Men SoftTouch Polo', 50, 99, 699, 599, 549],
            ['Men SoftTouch Polo', 100, null, 669, 569, 549],
            ['Men Printed Collar SoftTouch Polo', 1, 9, 799, 699, 599],
            ['Men Printed Collar SoftTouch Polo', 11, 49, 779, 679, 599],
            ['Men Printed Collar SoftTouch Polo', 50, 99, 749, 649, 599],
            ['Men Printed Collar SoftTouch Polo', 100, null, 719, 619, 599],
            ['Men Cozy Hoodie', 1, 10, 499, 424, 349],
            ['Men Cozy Hoodie', 11, 100, 449, 382, 314],
            ['Men Cozy Hoodie', 101, 500, 399, 339, 279],
            ['Men Cozy Hoodie', 501, null, 349, 297, 244],
            ['Men Cozy Zipper Hoodie', 1, 10, 499, 424, 349],
            ['Men Cozy Zipper Hoodie', 11, 100, 449, 382, 314],
            ['Men Cozy Zipper Hoodie', 101, 500, 399, 339, 279],
            ['Men Cozy Zipper Hoodie', 501, null, 349, 297, 244],
            ['Men Cozy Sweatshirt', 1, 10, 499, 424, 349],
            ['Men Cozy Sweatshirt', 11, 100, 449, 382, 314],
            ['Men Cozy Sweatshirt', 101, 500, 399, 339, 279],
            ['Men Cozy Sweatshirt', 501, null, 349, 297, 244],
            ['Men Cozy Varsity Jacket', 1, 10, 499, 424, 349],
            ['Men Cozy Varsity Jacket', 11, 100, 449, 382, 314],
            ['Men Cozy Varsity Jacket', 101, 500, 399, 339, 279],
            ['Men Cozy Varsity Jacket', 501, null, 349, 297, 244],
            ['Men Cozy Joggers', 1, 10, 499, 424, 349],
            ['Men Cozy Joggers', 11, 100, 449, 382, 314],
            ['Men Cozy Joggers', 101, 500, 399, 339, 279],
            ['Men Cozy Joggers', 501, null, 349, 297, 244],
            ['Men Cozy Shorts', 1, 10, 499, 424, 349],
            ['Men Cozy Shorts', 11, 100, 449, 382, 314],
            ['Men Cozy Shorts', 101, 500, 399, 339, 279],
            ['Men Cozy Shorts', 501, null, 349, 297, 244],
            ['Women Plain Crew Neck', 1, 10, 449, 349, 249],
            ['Women Plain Crew Neck', 11, 100, 429, 329, 249],
            ['Women Plain Crew Neck', 101, 500, 399, 299, 249],
            ['Women Plain Crew Neck', 501, null, 369, 269, 249],
            ['Women Amid Crop Top', 1, 10, 499, 399, 299],
            ['Women Amid Crop Top', 11, 100, 479, 379, 299],
            ['Women Amid Crop Top', 101, 500, 449, 349, 299],
            ['Women Amid Crop Top', 501, null, 419, 319, 299],
            ['Women Amid Crew Neck', 1, 10, 699, 560, 532],
            ['Women Amid Crew Neck', 11, 25, 629, 504, 476],
            ['Women Amid Crew Neck', 26, 50, 615, 493, 465],
            ['Women Amid Crew Neck', 51, 100, 594, 476, 448],
            ['Women Amid Crew Neck', 101, null, 559, 448, 420],
            ['Women SoftTouch Crew Neck', 1, 10, 699, 560, 532],
            ['Women SoftTouch Crew Neck', 11, 25, 629, 504, 476],
            ['Women SoftTouch Crew Neck', 26, 50, 615, 493, 465],
            ['Women SoftTouch Crew Neck', 51, 100, 594, 476, 448],
            ['Women SoftTouch Crew Neck', 101, null, 559, 448, 420],
            ['Women SoftTouch Oversized', 1, 10, 699, 599, 499],
            ['Women SoftTouch Oversized', 11, 100, 679, 579, 499],
            ['Women SoftTouch Oversized', 101, 500, 649, 549, 499],
            ['Women SoftTouch Oversized', 501, null, 619, 519, 499],
        ];

        // Data table: [style, addon, min, max, retail, corporate, reseller]
        const RATES = [
            // MOQ
            ['MOQ', 'DTG', 1, null, 1, 1, 1],
            ['MOQ', 'DTF', 1, null, 1, 1, 1],
            ['MOQ', 'Screen Print', 1, null, 50, 50, 50],
            ['MOQ', 'Embroidery (Standard)', 1, null, 1, 1, 1],
            ['MOQ', 'Embroidery (Coloreel)', 1, null, 1, 1, 1],
            // Setup Charge
            ['Setup Charge', 'Screen Print', 1, 9, 1200, 1100, 1000],
            ['Setup Charge', 'Screen Print', 10, 49, 500, 500, 500],
            ['Setup Charge', 'Screen Print', 50, 99, 500, 500, 500],
            ['Setup Charge', 'Screen Print', 100, null, 500, 500, 500],
            ['Setup Charge', 'Embroidery (Standard)', 1, 9, 300, 250, 200],
            ['Setup Charge', 'Embroidery (Standard)', 10, 49, 300, 250, 200],
            ['Setup Charge', 'Embroidery (Standard)', 50, 99, 300, 250, 200],
            ['Setup Charge', 'Embroidery (Standard)', 100, null, 300, 250, 200],
            ['Setup Charge', 'Embroidery (Coloreel)', 1, 9, 400, 350, 300],
            ['Setup Charge', 'Embroidery (Coloreel)', 10, 49, 400, 350, 300],
            ['Setup Charge', 'Embroidery (Coloreel)', 50, 99, 400, 350, 300],
            ['Setup Charge', 'Embroidery (Coloreel)', 100, null, 400, 350, 300],
            // Rates
            ['Rate', 'DTG', 1, 9, 1.2, 1.1, 1],
            ['Rate', 'DTG', 10, 99, 1.2, 1.1, 1],
            ['Rate', 'DTG', 100, 499, 1.2, 1.1, 1],
            ['Rate', 'DTG', 500, null, 1.2, 1.1, 1],
            ['Rate', 'DTF', 1, 10, 0.5, 0.5, 0.5],
            ['Rate', 'DTF', 11, 100, 0.5, 0.5, 0.5],
            ['Rate', 'DTF', 101, 500, 0.5, 0.5, 0.5],
            ['Rate', 'DTF', 501, null, 0.5, 0.5, 0.5],
            ['Rate', 'Screen Print', 1, 9, 4, 4, 4],
            ['Rate', 'Screen Print', 10, 49, 4, 4, 4],
            ['Rate', 'Screen Print', 50, 99, 4, 4, 4],
            ['Rate', 'Screen Print', 100, null, 4, 4, 4],
            ['Rate', 'Embroidery (Standard)', 1, 9, 5, 5, 5],
            ['Rate', 'Embroidery (Standard)', 10, 49, 4, 4, 4],
            ['Rate', 'Embroidery (Standard)', 50, 99, 3, 3, 3],
            ['Rate', 'Embroidery (Standard)', 100, null, 2, 2, 2],
            ['Rate', 'Embroidery (Coloreel)', 1, 9, 6, 6, 6],
            ['Rate', 'Embroidery (Coloreel)', 10, 49, 5, 5, 5],
            ['Rate', 'Embroidery (Coloreel)', 50, 99, 4, 4, 4],
            ['Rate', 'Embroidery (Coloreel)', 100, null, 3, 3, 3],
            ['Rate', 'Loop Label', 1, 10, 20, 18, 16],
            ['Rate', 'Loop Label', 11, 100, 15, 13, 11],
            ['Rate', 'Loop Label', 101, 500, 10, 8, 6],
            ['Rate', 'Loop Label', 501, null, 5, 4, 3],
            ['Rate', 'Hang Tag', 1, 10, 25, 23, 20],
            ['Rate', 'Hang Tag', 11, 100, 20, 18, 16],
            ['Rate', 'Hang Tag', 101, 500, 10, 8, 7],
            ['Rate', 'Hang Tag', 501, null, 8, 7, 6],
            ['Rate', 'Textile Patch', 1, 10, 25, 23, 20],
            ['Rate', 'Textile Patch', 11, 100, 20, 18, 16],
            ['Rate', 'Textile Patch', 101, 500, 15, 13, 11],
            ['Rate', 'Textile Patch', 501, null, 10, 8, 6],
        ];

        // Product addons map
        const PRODUCT_ADDONS = {
            'Men Amid Crew Neck': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men SoftTouch Crew Neck': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men SoftTouch Oversized': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Brisk Polo': ['DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Plain Polo': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Performance Polo': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Flexi Polo': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men SoftTouch Polo': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Printed Collar SoftTouch Polo': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Cozy Hoodie': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Cozy Zipper Hoodie': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Cozy Sweatshirt': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Cozy Varsity Jacket': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Cozy Joggers': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Cozy Shorts': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Women Plain Crew Neck': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Women Amid Crop Top': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Women Amid Crew Neck': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Women SoftTouch Crew Neck': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Women SoftTouch Oversized': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
            'Men Plain Crew Neck': ['DTG', 'DTF', 'Screen Print', 'Embroidery (Standard)', 'Embroidery (Coloreel)', 'Loop Label', 'Hang Tag', 'Textile Patch'],
        };

        const LOCATIONS = ['FRONT', 'BACK', 'LEFT SLEEVE', 'RIGHT SLEEVE'];

        createApp({
            setup() {
                const customerTypes = ['Retail', 'Corporate', 'Reseller'];
                const customerType = ref('Retail');
                const sizes = ['XS', 'S', 'M', 'L', 'XL', '2XL', '3XL', '4XL'];

                const products = Object.keys(PRODUCT_ADDONS);

                const selectedProduct = ref('');
                const quantities = reactive({});
                sizes.forEach(s => quantities[s] = 0);

                const shippingCharges = ref(0);

                // addon state: { [locAddonKey]: { enabled, width, height, colours } }
                const addonStates = reactive({});

                const step = computed(() => {
                    if (!selectedProduct.value) return 2;
                    if (totalQty.value === 0) return 3;
                    return 4;
                });

                const totalQty = computed(() => sizes.reduce((s, sz) => s + (quantities[sz] || 0), 0));

                function ctIdx() {
                    return customerType.value === 'Retail' ? 0 : customerType.value === 'Corporate' ? 1 : 2;
                }

                function lookupRate(style, addon, qty) {
                    const ci = ctIdx();
                    const rows = RATES.filter(r => r[0] === style && r[1] === addon);
                    for (const r of rows) {
                        const [, , min, max, retail, corp, res] = r;
                        if (qty >= min && (max === null || qty <= max)) {
                            return [retail, corp, res][ci];
                        }
                    }
                    return 0;
                }

                const pricePerItem = computed(() => {
                    if (!selectedProduct.value || totalQty.value === 0) return 0;
                    const ci = ctIdx();
                    const rows = PRODUCT_DATA.filter(r => r[0] === selectedProduct.value);
                    for (const r of rows) {
                        const [, min, max, retail, corp, res] = r;
                        if (totalQty.value >= min && (max === null || totalQty.value <= max)) {
                            return [retail, corp, res][ci];
                        }
                    }
                    return 0;
                });

                const addonLocations = computed(() => {
                    if (!selectedProduct.value) return [];
                    const addons = PRODUCT_ADDONS[selectedProduct.value] || [];
                    return LOCATIONS.map(loc => ({
                        name: loc,
                        addons: addons.map(type => ({ type }))
                    }));
                });

                function addonKey(loc, type) { return `${loc}||${type}`; }

                function getAddonState(loc, type) {
                    const k = addonKey(loc, type);
                    if (!addonStates[k]) {
                        addonStates[k] = reactive({ enabled: false, width: 4, height: 4, colours: 1 });
                    }
                    return addonStates[k];
                }

                function isAddonEnabled(loc, type) {
                    return getAddonState(loc, type).enabled;
                }

                function toggleAddon(loc, type) {
                    const s = getAddonState(loc, type);
                    s.enabled = !s.enabled;
                }

                function getSetupCharge(type) {
                    return lookupRate('Setup Charge', type, totalQty.value);
                }

                function getRate(type) {
                    return lookupRate('Rate', type, totalQty.value);
                }

                function getAddonTotal(loc, type) {
                    const s = getAddonState(loc, type);
                    if (!s.enabled) return 0;
                    const qty = totalQty.value;
                    const rate = getRate(type);

                    if (type === 'DTG') {
                        const area = (s.width || 4) * (s.height || 4);
                        const raw = area * rate;
                        return Math.max(80, raw);
                    } else if (type === 'DTF') {
                        const area = (s.width || 4) * (s.height || 4);
                        const raw = area * rate;
                        return Math.max(40, raw);
                    } else if (type === 'Screen Print') {
                        const area = (s.width || 4) * (s.height || 4);
                        const raw = area * rate;
                        return Math.max(20, raw);
                    } else if (type === 'Embroidery (Standard)') {
                        const area = (s.width || 4) * (s.height || 4);
                        const stitches = area * 1000;
                        const raw = (stitches / 1000) * rate;
                        return Math.max(30, raw);
                    } else if (type === 'Embroidery (Coloreel)') {
                        const area = (s.width || 4) * (s.height || 4);
                        const stitches = area * 1200;
                        const raw = (stitches / 1000) * rate;
                        return Math.max(40, raw);
                    } else {
                        // Label / patch etc: rate per piece
                        return rate;
                    }
                }

                const addonBreakdown = computed(() => {
                    const rows = [];
                    for (const loc of LOCATIONS) {
                        for (const type of (PRODUCT_ADDONS[selectedProduct.value] || [])) {
                            const t = getAddonTotal(loc, type);
                            if (t > 0) {
                                rows.push({
                                    label: `${loc} — ${type}`,
                                    perItem: t,
                                    total: t * totalQty.value
                                });
                            }
                        }
                    }
                    return rows;
                });

                const totalAddonPerItem = computed(() =>
                    addonBreakdown.value.reduce((s, r) => s + r.perItem, 0)
                );

                const totalSetupCharges = computed(() => {
                    let total = 0;
                    for (const loc of LOCATIONS) {
                        for (const type of (PRODUCT_ADDONS[selectedProduct.value] || [])) {
                            const s = getAddonState(loc, type);
                            if (s.enabled) {
                                const setupCharge = getSetupCharge(type);
                                if (type === 'Screen Print') {
                                    total += setupCharge * (s.colours || 1);
                                } else {
                                    total += setupCharge;
                                }
                            }
                        }
                    }
                    return total;
                });

                const grandTotal = computed(() => {
                    const productTotal = pricePerItem.value * totalQty.value;
                    const addonTotal = totalAddonPerItem.value * totalQty.value;
                    return productTotal + addonTotal + totalSetupCharges.value + (shippingCharges.value || 0);
                });

                const finalPricePerItem = computed(() => {
                    if (totalQty.value === 0) return 0;
                    return grandTotal.value / totalQty.value;
                });

                function setCustomerType(ct) {
                    customerType.value = ct;
                }

                function onProductChange() {
                    // Reset addons
                    Object.keys(addonStates).forEach(k => delete addonStates[k]);
                }

                function onQtyChange() { }
                function recalc() { }

                function fmt(val) {
                    if (val === 0 || !val) return '0';
                    return Number(val).toFixed(2).replace(/\.00$/, '');
                }

                return {
                    customerTypes, customerType, setCustomerType,
                    sizes, products, selectedProduct, quantities,
                    step, totalQty, pricePerItem,
                    addonLocations, addonStates,
                    isAddonEnabled, toggleAddon, getAddonState,
                    getSetupCharge, getRate, getAddonTotal,
                    addonBreakdown, totalAddonPerItem, totalSetupCharges,
                    shippingCharges, grandTotal, finalPricePerItem,
                    onProductChange, onQtyChange, recalc, fmt
                };
            }
        }).mount('#app');
    </script>
</body>

</html>
